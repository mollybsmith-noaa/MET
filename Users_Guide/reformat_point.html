

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Re-Formatting of Point Observations &mdash; MET 9.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Re-Formatting of Gridded Fields" href="reformat_grid.html" />
    <link rel="prev" title="3. MET Data I/O" href="data_io.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> MET
          

          
            
            <img src="../_static/met_logo_2019_09.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                9.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Model Evaluation Tools</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">1. Overview of MET</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">2. Software Installation/Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_io.html">3. MET Data I/O</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. Re-Formatting of Point Observations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pb2nc-tool">4.1. PB2NC tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pb2nc-usage">4.1.1. pb2nc usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pb2nc-configuration-file">4.1.2. pb2nc configuration file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pb2nc-output">4.1.3. pb2nc output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ascii2nc-tool">4.2. ASCII2NC tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ascii2nc-usage">4.2.1. ascii2nc usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ascii2nc-configuration-file">4.2.2. ascii2nc configuration file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ascii2nc-output">4.2.3. ascii2nc output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#madis2nc-tool">4.3. MADIS2NC tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#madis2nc-usage">4.3.1. madis2nc usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#madis2nc-configuration-file">4.3.2. madis2nc configuration file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#madis2nc-output">4.3.3. madis2nc output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lidar2nc-tool">4.4. LIDAR2NC tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lidar2nc-usage">4.4.1. lidar2nc usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lidar2nc-output">4.4.2. lidar2nc output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#point2grid-tool">4.5. Point2Grid tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#point2grid-usage">4.5.1. point2grid usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#point2grid-output">4.5.2. point2grid output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reformat_grid.html">5. Re-Formatting of Gridded Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="masking.html">6. Regional Verification using Spatial Masking</a></li>
<li class="toctree-l2"><a class="reference internal" href="point-stat.html">7. Point-Stat Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid-stat.html">8. Grid-Stat Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="ensemble-stat.html">9. Ensemble-Stat Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="wavelet-stat.html">10. Wavelet-Stat Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="gsi-tools.html">11. GSI Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="stat-analysis.html">12. Stat-Analysis Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="series-analysis.html">13. Series-Analysis Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid-diag.html">14. Grid-Diag Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="mode.html">15. MODE Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="mode-analysis.html">16. MODE-Analysis Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="mode-td.html">17. MODE Time Domain Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="met-tc_overview.html">18. MET-TC Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="tc-dland.html">19. TC-Dland Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tc-pairs.html">20. TC-Pairs Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tc-stat.html">21. TC-Stat Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tc-gen.html">22. TC-Gen Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="tc-rmw.html">23. TC-RMW Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="rmw-analysis.html">24. RMW-Analysis Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotting.html">25. Plotting and Graphics Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="refs.html">26. References</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendixA.html">27. Appendix A FAQs &amp; How do I … ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendixB.html">28. Appendix B Map Projections, Grids, and Polylines</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendixC.html">29. Appendix C Verification Measures</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendixD.html">30. Appendix D Confidence Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendixE.html">31. Appendix E WWMCA Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendixF.html">32. Appendix F Python Embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendixG.html">33. Appendix G Vectors and Vector Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Contributors_Guide/index.html">Contributor’s Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MET</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">User’s Guide</a> &raquo;</li>
        
      <li><span class="section-number">4. </span>Re-Formatting of Point Observations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Users_Guide/reformat_point.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="re-formatting-of-point-observations">
<span id="reformat-point"></span><h1><span class="section-number">4. </span>Re-Formatting of Point Observations<a class="headerlink" href="#re-formatting-of-point-observations" title="Permalink to this headline">¶</a></h1>
<p>There are several formats of point observations that may preprocessed using the suite of reformatting tools in MET. These include PrepBUFR data from NCEP, SURFRAD data from NOAA, AERONET data from NASA, MADIS data from NOAA, little_r from WRF simulations, and user-defined data in a generic ASCII format. These steps are represented by the first columns in the MET flowchart depicted in <a class="reference internal" href="overview.html#overview"><span class="std std-numref">Section 1</span></a>. The software tools used to reformat point data are described in this section.</p>
<div class="section" id="pb2nc-tool">
<span id="id1"></span><h2><span class="section-number">4.1. </span>PB2NC tool<a class="headerlink" href="#pb2nc-tool" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to configure and run the PB2NC tool. The PB2NC tool is used to stratify the contents of an input PrepBUFR point observation file and reformat it into NetCDF format for use by other MET tools. The PB2NC tool must be run on the input PrepBUFR point observation file prior to performing verification with the MET statistics tools.</p>
<div class="section" id="pb2nc-usage">
<span id="id2"></span><h3><span class="section-number">4.1.1. </span>pb2nc usage<a class="headerlink" href="#pb2nc-usage" title="Permalink to this headline">¶</a></h3>
<p>The usage statement for the PB2NC tool is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: pb2nc
       prepbufr_file
       netcdf_file
       config_file
       [-pbfile PrepBUFR_file]
       [-valid_beg time]
       [-valid_end time]
       [-nmsg n]
       [-dump path]
       [-index]
       [-log file]
       [-v level]
       [-compress level]
</pre></div>
</div>
<p>pb2nc has both required and optional arguments.</p>
<div class="section" id="required-arguments-for-pb2nc">
<h4><span class="section-number">4.1.1.1. </span>Required arguments for pb2nc<a class="headerlink" href="#required-arguments-for-pb2nc" title="Permalink to this headline">¶</a></h4>
<p>1.
The <strong>prepbufr_file</strong> argument is the input PrepBUFR file to be processed.</p>
<p>2.
The <strong>netcdf_file</strong> argument is the output NetCDF file to be written.</p>
<p>3.
The <strong>config_file</strong> argument is the configuration file to be used. The contents of the configuration file are discussed below.</p>
</div>
<div class="section" id="optional-arguments-for-pb2nc">
<h4><span class="section-number">4.1.1.2. </span>Optional arguments for pb2nc<a class="headerlink" href="#optional-arguments-for-pb2nc" title="Permalink to this headline">¶</a></h4>
<p>1.
The <strong>-pbfile prepbufr_file</strong> option is used to pass additional input PrepBUFR files.</p>
<p>2.
The <strong>-valid_beg</strong> time option in YYYYMMDD[_HH[MMSS]] format sets the beginning of the retention time window.</p>
<p>3.
The <strong>-valid_end</strong> time option in YYYYMMDD[_HH[MMSS]] format sets the end of the retention time window.</p>
<p>4.
The <strong>-nmsg num_messages</strong> option may be used for testing purposes. This argument indicates that only the first “num_messages” PrepBUFR messages should be processed rather than the whole file. This option is provided to speed up testing because running the PB2NC tool can take a few minutes for each file. Most users will not need this option.</p>
<p>5.
The <strong>-dump path</strong> option may be used to dump the entire contents of the PrepBUFR file to several ASCII files written to the directory specified by “path”. The user may use this option to view a human-readable version of the input PrepBUFR file, although writing the contents to ASCII files can be slow.</p>
<p>6.
The <strong>-index</strong> option shows the available variables with valid data from the BUFR input. It collects the available variable list from BUFR input and checks the existence of valid data and directs the variable names with valid data to the screen. The NetCDF output won’t be generated.</p>
<p>7.
The <strong>-log</strong> file option directs output and errors to the specified log file. All messages will be written to that file as well as standard out and error. Thus, users can save the messages without having to redirect the output on the command line. The default behavior is no log file.</p>
<p>8.
The <strong>-v level</strong> option indicates the desired level of verbosity. The value of “level” will override the default setting of 2. Setting the verbosity to 0 will make the tool run with no log messages, while increasing the verbosity above 1 will increase the amount of logging.</p>
<p>9.
The <strong>-compress level</strong> option indicates the desired level of compression (deflate level) for NetCDF variables. The valid level is between 0 and 9. The value of “level” will override the default setting of 0 from the configuration file or the environment variable MET_NC_COMPRESS. Setting the compression level to 0 will make no compression for the NetCDF output. Lower number is for fast compression and higher number is for better compression.</p>
<p>An example of the pb2nc calling sequence is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pb2nc sample_pb.blk \
sample_pb.nc \
PB2NCConfig
</pre></div>
</div>
<p>In this example, the PB2NC tool will process the input <strong>sample_pb.blk</strong> file applying the configuration specified in the <strong>PB2NCConfig</strong> file and write the output to a file named <strong>sample_pb.nc</strong>.</p>
</div>
</div>
<div class="section" id="pb2nc-configuration-file">
<span id="id3"></span><h3><span class="section-number">4.1.2. </span>pb2nc configuration file<a class="headerlink" href="#pb2nc-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>The default configuration file for the PB2NC tool named <strong>PB2NCConfig_default</strong> can be found in the installed share/met/config directory. The version used for the example run in <a class="reference internal" href="installation.html#sample-test-cases"><span class="std std-numref">Section 2.11</span></a> is available in <strong>scripts/config</strong>. It is recommended that users make a copy of configuration files prior to modifying their contents.</p>
<p>When editing configuration files, environment variables may be used for setting the configurable parameters if convenient. The configuration file parser expands any environment variables to their full value before proceeding. Within the configuration file, environment variables must be specified in the form: <strong>${VAR_NAME}</strong>.</p>
<p>For example, using an environment variable to set the <strong>message_type</strong> (see below) parameter to use ADPUPA and ADPSFC message types might consist of the following:</p>
<p>* In a C-Shell: <strong>setenv MSG_TYP ‘ “ADPUPA”, “ADPSFC” ‘</strong></p>
<p>* In the configuration file: <strong>message_type = [ ${MSG_TYP} ];</strong></p>
<blockquote>
<div><p>The contents of the default pb2nc configuration file are described below.</p>
</div></blockquote>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>obs_window = { beg  = -5400; end  = 5400; }
mask       = { grid = &quot;&quot;;    poly = &quot;&quot;;   }
tmp_dir    = &quot;/tmp&quot;;
version    = &quot;VN.N&quot;;
</pre></div>
</div>
<p>The configuration options listed above are common to many MET tools and are described in <a class="reference internal" href="data_io.html#data-io-met-configuration-file-options"><span class="std std-numref">Section 3.5.1</span></a>.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>message_type = [];
</pre></div>
</div>
<p>Each PrepBUFR message is tagged with one of eighteen message types as listed in the share/met/config/README file. The ‘message_type’ refers to the type of observation from which the observation value (or ‘report’) was derived. The user may specify a comma-separated list of message types to be retained. Providing an empty list indicates that all message types should be retained.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>message_type_map = [ { key = “AIRCAR”; val = “AIRCAR_PROFILES”; } ];
</pre></div>
</div>
<p>The <strong>message_type_map</strong> entry is an array of dictionaries, each containing a <strong>key</strong> string and <strong>val</strong> string. This defines a mapping of input PrepBUFR message types to output message types. This provides a method for renaming input PrepBUFR message types.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>message_type_group_map = [
   { key = &quot;SURFACE&quot;; val = &quot;ADPSFC,SFCSHP,MSONET&quot;;               },
   { key = &quot;ANYAIR&quot;;  val = &quot;AIRCAR,AIRCFT&quot;;                      },
   { key = &quot;ANYSFC&quot;;  val = &quot;ADPSFC,SFCSHP,ADPUPA,PROFLR,MSONET&quot;; },
   { key = &quot;ONLYSF&quot;;  val = &quot;ADPSFC,SFCSHP&quot;;                      }

                          ];
</pre></div>
</div>
<p>The <strong>message_type_group_map</strong> entry is an array of dictionaries, each containing a <strong>key</strong> string and <strong>val</strong> string. This defines a mapping of message type group names to a comma-separated list of values. This map is defined in the config files for PB2NC, Point-Stat, or Ensemble-Stat. Modify this map to define sets of message types that should be processed together as a group. The <strong>SURFACE</strong> entry must be present to define message types for which surface verification logic should be applied.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>station_id = [];
</pre></div>
</div>
<p>Each PrepBUFR message has a station identification string associated with it. The user may specify a comma-separated list of station IDs to be retained. Providing an empty list indicates that messages from all station IDs will be retained. It can be a file name containing a list of stations.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>elevation_range = { beg = -1000; end = 100000; }
</pre></div>
</div>
<p>The <strong>beg</strong> and <strong>end</strong> variables are used to stratify the elevation (in meters) of the observations to be retained. The range shown above is set to -1000 to 100000 meters, which essentially retains every observation.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pb_report_type  = [];
in_report_type  = [];
instrument_type = [];
</pre></div>
</div>
<p>The <strong>pb_report_type, in_report_type</strong>, and <strong>instrument_type</strong> variables are used to specify comma-separated lists of PrepBUFR report types, input report types, and instrument types to be retained, respectively. If left empty, all PrepBUFR report types, input report types, and instrument types will be retained. See the following for more details:</p>
<p><a class="reference external" href="https://www.emc.ncep.noaa.gov/mmb/data_processing/prepbufr.doc/table_4.htm">https://www.emc.ncep.noaa.gov/mmb/data_processing/prepbufr.doc/table_4.htm</a></p>
<p><a class="reference external" href="https://www.emc.ncep.noaa.gov/mmb/data_processing/prepbufr.doc/table_6.htm">https://www.emc.ncep.noaa.gov/mmb/data_processing/prepbufr.doc/table_6.htm</a></p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>level_range    = { beg = 1; end = 255; }
level_category = [];
</pre></div>
</div>
<p>The <strong>beg</strong> and <strong>end</strong> variables are used to stratify the model level of observations to be retained. The range shown above is 1 to 255.</p>
<p>The <strong>level_category</strong> variable is used to specify a comma-separated list of PrepBUFR data level categories to retain. An empty string indicates that all level categories should be retained. Accepted values and their meanings are described in <a class="reference internal" href="#table-reform-point-pb2nc-level-category"><span class="std std-numref">Table 4.1</span></a>. See the following for more details:</p>
<p><a class="reference external" href="https://www.emc.ncep.noaa.gov/mmb/data_processing/prepbufr.doc/table_1.htm">https://www.emc.ncep.noaa.gov/mmb/data_processing/prepbufr.doc/table_1.htm</a></p>
<span id="table-reform-point-pb2nc-level-category"></span><table class="colwidths-auto docutils align-default" id="id5">
<caption><span class="caption-number">Table 4.1 </span><span class="caption-text">Values for the level_category option.</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Level category value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Surface level</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Mandatory level</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Significant temperature level</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Winds-by-pressure level</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Winds-by-height level</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Tropopause level</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Reports on a single level</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>Auxiliary levels generated via interpolation from spanning levels</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>obs_bufr_var = [ &#39;QOB&#39;, &#39;TOB&#39;, &#39;ZOB&#39;, &#39;UOB&#39;, &#39;VOB&#39; ];
</pre></div>
</div>
<p>Each PrepBUFR message will likely contain multiple observation variables. The <strong>obs_bufr_var</strong> variable is used to specify which observation variables should be retained or derived. The variable name comes from BUFR file which includes BUFR table. The following BUFR names may be retained: QOB, TOB, ZOB, UOB, and VOB for specific humidity, temperature, height, and the u and v components of winds. The following BUFR names may be derived: D_DPT, D_WIND, D_RH, D_MIXR, D_PRMSL, D_PBL, and D_CAPE for dew point, wind speed, relative humidity, mixing ratio, pressure reduced to MSL, planetary boundary layer height, and convective available potential energy. This configuration replaces <strong>obs_grib_code</strong>. If the list is empty, all BUFR variables are retained.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>obs_bufr_map = [
{ key = &#39;POB&#39;;      val = &#39;PRES&#39;;  },
{ key = &#39;QOB&#39;;      val = &#39;SPFH&#39;;  },
{ key = &#39;TOB&#39;;      val = &#39;TMP&#39;;   },
{ key = &#39;ZOB&#39;;      val = &#39;HGT&#39;;   },
{ key = &#39;UOB&#39;;      val = &#39;UGRD&#39;;  },
{ key = &#39;VOB&#39;;      val = &#39;VGRD&#39;;  },
{ key = &#39;D_DPT&#39;;    val = &#39;DPT&#39;;   },
{ key = &#39;D_WDIR&#39;;   val = &#39;WDIR&#39;;  },
{ key = &#39;D_WIND&#39;;   val = &#39;WIND&#39;;  },
{ key = &#39;D_RH&#39;;     val = &#39;RH&#39;;    },
{ key = &#39;D_MIXR&#39;;   val = &#39;MIXR&#39;;  },
{ key = &#39;D_PRMSL&#39;;  val = &#39;PRMSL&#39;; },
{ key = &#39;D_PBL&#39;;    val = &#39;PBL&#39;;   },
{ key = &#39;D_CAPE&#39;;   val = &#39;CAPE&#39;;  }
];
</pre></div>
</div>
<p>The BUFR variable names are not shared with other forecast data. This map is used to convert the BUFR name to the common name, like GRIB2. It allows to share the configuration for forecast data with PB2NC observation data. If there is no mapping, the BUFR variable name will be saved to output NetCDF file.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>quality_mark_thresh = 2;
</pre></div>
</div>
<p>Each observation has a quality mark value associated with it. The <strong>quality_mark_thresh</strong> is used to stratify out which quality marks will be retained. The value shown above indicates that only observations with quality marks less than or equal to 2 will be retained.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>event_stack_flag = TOP;
</pre></div>
</div>
<p>A PrepBUFR message may contain duplicate observations with different quality mark values. The <strong>event_stack_flag</strong> indicates whether to use the observations at the top of the event stack (observation values have had more quality control processing applied) or the bottom of the event stack (observation values have had no quality control processing applied). The flag value of <strong>TOP</strong> listed above indicates the observations with the most amount of quality control processing should be used, the <strong>BOTTOM</strong> option uses the data closest to raw values.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>time_summary = {
flag       = FALSE;
raw_data   = FALSE;
beg        = &quot;000000&quot;;
end        = &quot;235959&quot;;
step       = 300;
width      = 600;
// width   = { beg = -300; end = 300; }
grib_code  = [];
obs_var    = [ &quot;TMP&quot;, &quot;WDIR&quot;, &quot;RH&quot; ];
type       = [ &quot;min&quot;, &quot;max&quot;, &quot;range&quot;, &quot;mean&quot;, &quot;stdev&quot;, &quot;median&quot;, &quot;p80&quot; ];
vld_freq   = 0;
vld_thresh = 0.0;
}
</pre></div>
</div>
<p>The <strong>time_summary</strong> dictionary enables additional processing for observations with high temporal resolution. The <strong>flag</strong> entry toggles the <strong>time_summary</strong> on (<strong>TRUE</strong>) and off (<strong>FALSE</strong>). If the <strong>raw_data</strong> flag is set to TRUE, then both the individual observation values and the derived time summary value will be written to the output. If FALSE, only the summary values are written. Observations may be summarized across the user specified time period defined by the <strong>beg</strong> and <strong>end</strong> entries in HHMMSS format. The <strong>step</strong> entry defines the time between intervals in seconds. The <strong>width</strong> entry specifies the summary interval in seconds. It may either be set as an integer number of seconds for a centered time interval or a dictionary with beginning and ending time offsets in seconds.</p>
<p>This example listed above does a 10-minute time summary (width = 600;) every 5 minutes (step = 300;) throughout the day (beg = “000000”; end = 235959”;). The first interval will be from 23:55:00 the previous day through 00:04:59 of the current day. The second interval will be from 0:00:00 through 00:09:59. And so on.</p>
<p>The two <strong>width</strong> settings listed above are equivalent. Both define a centered 10-minute time interval. Use the <strong>beg</strong> and <strong>end</strong> entries to define uncentered time intervals. The following example requests observations for one hour prior:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>width = { beg = -3600; end = 0; }
</pre></div>
</div>
<p>The summaries will only be calculated for the observations specified in the <strong>grib_code</strong> or <strong>obs_var</strong> entries. The <strong>grib_code</strong> entry is an array of integers while the <strong>obs_var</strong> entries is an array of strings. The supported summaries are <strong>min</strong> (minimum), <strong>max</strong> (maximum), <strong>range, mean, stdev</strong> (standard deviation), <strong>median</strong> and <strong>p##</strong> (percentile, with the desired percentile value specified in place of ##). If multiple summaries are selected in a single run, a string indicating the summary method applied will be appended to the output message type.</p>
<p>The <strong>vld_freq</strong> and <strong>vld_thresh</strong> entries specify the required ratio of valid data for an output time summary value to be computed. This option is only applied when these entries are set to non-zero values. The <strong>vld_freq</strong> entry specifies the expected frequency of observations in seconds. The width of the time window is divided by this frequency to compute the expected number of observations for the time window. The actual number of valid observations is divided by the expected number to compute the ratio of valid data. An output time summary value will only be written if that ratio is greater than or equal to the <strong>vld_thresh</strong> entry. Detailed information about which observations are excluded is provided at debug level 4.</p>
</div>
<div class="section" id="pb2nc-output">
<span id="id4"></span><h3><span class="section-number">4.1.3. </span>pb2nc output<a class="headerlink" href="#pb2nc-output" title="Permalink to this headline">¶</a></h3>
<p>Each NetCDF file generated by the PB2NC tool contains the dimensions and variables shown in <a class="reference internal" href="#table-reform-point-pb2nc-output-dim"><span class="std std-numref">Table 4.2</span></a> and <a class="reference internal" href="#table-reform-point-pb2nc-output-vars"><span class="std std-numref">Table 4.3</span></a>.</p>
<span id="table-reform-point-pb2nc-output-dim"></span><table class="colwidths-auto docutils align-default" id="id6">
<caption><span class="caption-number">Table 4.2 </span><span class="caption-text">NetCDF file dimensions for pb2n output</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>pb2nc NetCDF DIMENSIONS</p></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>NetCDF Dimension</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>mxstr, mxstr2, mxstr3</p></td>
<td><p>Maximum string lengths (16, 40, and 80)</p></td>
</tr>
<tr class="row-even"><td><p>nobs</p></td>
<td><p>Number of PrepBUFR observations in the file (UNLIMITED)</p></td>
</tr>
<tr class="row-odd"><td><p>nhdr, npbhdr</p></td>
<td><p>Number of PrepBUFR messages in the file (variable)</p></td>
</tr>
<tr class="row-even"><td><p>nhdr_typ, nhdr_sid, nhdr_vld</p></td>
<td><p>Number of unique header message type, station ID, and valid time strings (variable)</p></td>
</tr>
<tr class="row-odd"><td><p>nobs_qty</p></td>
<td><p>Number of unique quality control strings (variable)</p></td>
</tr>
<tr class="row-even"><td><p>obs_var_num</p></td>
<td><p>Number of unique observation variable types (variable)</p></td>
</tr>
</tbody>
</table>
<span id="table-reform-point-pb2nc-output-vars"></span><table class="colwidths-auto docutils align-default" id="id7">
<caption><span class="caption-number">Table 4.3 </span><span class="caption-text">NetCDF variables in pb2nc output</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>pb2nc NetCDF VARIABLES</p></th>
<th class="head"></th>
<th class="head"></th>
</tr>
<tr class="row-even"><th class="head"><p>NetCDF Variable</p></th>
<th class="head"><p>Dimension</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>obs_qty</p></td>
<td><p>nobs</p></td>
<td><p>Integer value of the n_obs_qty dimension for the observation quality control string.</p></td>
</tr>
<tr class="row-even"><td><p>obs_hid</p></td>
<td><p>nobs</p></td>
<td><p>Integer value of the nhdr dimension for the header arrays with which this observation is associated.</p></td>
</tr>
<tr class="row-odd"><td><p>obs_vid</p></td>
<td><p>nobs</p></td>
<td><p>Integer value of the obs_var_num dimension for the observation variable name, units, and description.</p></td>
</tr>
<tr class="row-even"><td><p>obs_lvl</p></td>
<td><p>nobs</p></td>
<td><p>Floating point pressure level in hPa or accumulation interval.</p></td>
</tr>
<tr class="row-odd"><td><p>obs_hgt</p></td>
<td><p>nobs</p></td>
<td><p>Floating point height in meters above sea level.</p></td>
</tr>
<tr class="row-even"><td><p>obs_val</p></td>
<td><p>nobs</p></td>
<td><p>Floating point observation value.</p></td>
</tr>
<tr class="row-odd"><td><p>hdr_typ</p></td>
<td><p>nhdr</p></td>
<td><p>Integer value of the nhdr_typ dimension for the message type string.</p></td>
</tr>
<tr class="row-even"><td><p>hdr_sid</p></td>
<td><p>nhdr</p></td>
<td><p>Integer value of the nhdr_sid dimension for the station ID string.</p></td>
</tr>
<tr class="row-odd"><td><p>hdr_vld</p></td>
<td><p>nhdr</p></td>
<td><p>Integer value of the nhdr_vld dimension for the valid time string.</p></td>
</tr>
<tr class="row-even"><td><p>hdr_lat, hdr_lon</p></td>
<td><p>nhdr</p></td>
<td><p>Floating point latitude in degrees north and longitude in degrees east.</p></td>
</tr>
<tr class="row-odd"><td><p>hdr_elv</p></td>
<td><p>nhdr</p></td>
<td><p>Floating point elevation of observing station in meters above sea level.</p></td>
</tr>
<tr class="row-even"><td><p>hdr_prpt_typ</p></td>
<td><p>npbhdr</p></td>
<td><p>Integer PrepBUFR report type value.</p></td>
</tr>
<tr class="row-odd"><td><p>hdr_irpt_typ</p></td>
<td><p>npbhdr</p></td>
<td><p>Integer input report type value.</p></td>
</tr>
<tr class="row-even"><td><p>hdr_inst_typ</p></td>
<td><p>npbhdr</p></td>
<td><p>Integer instrument type value.</p></td>
</tr>
<tr class="row-odd"><td><p>hdr_typ_table</p></td>
<td><p>nhdr_typ,</p></td>
<td><p>mxstr2 Lookup table containing unique message type strings.</p></td>
</tr>
<tr class="row-even"><td><p>hdr_sid_table</p></td>
<td><p>nhdr_sid,</p></td>
<td><p>mxstr2 Lookup table containing unique station ID strings.</p></td>
</tr>
<tr class="row-odd"><td><p>hdr_vld_table</p></td>
<td><p>nhdr_vld, mxstr</p></td>
<td><p>Lookup table containing unique valid time strings in YYYYMMDD_HHMMSS UTC format.</p></td>
</tr>
<tr class="row-even"><td><p>obs_qty_table</p></td>
<td><p>nobs_qty, mxstr</p></td>
<td><p>Lookup table containing unique quality control strings.</p></td>
</tr>
<tr class="row-odd"><td><p>obs_var</p></td>
<td><p>obs_var_num, mxstr</p></td>
<td><p>Lookup table containing unique observation variable names.</p></td>
</tr>
<tr class="row-even"><td><p>obs_unit</p></td>
<td><p>obs_var_num, mxstr2</p></td>
<td><p>Lookup table containing a units string for the unique observation variable names in obs_var.</p></td>
</tr>
<tr class="row-odd"><td><p>obs_desc</p></td>
<td><p>obs_var_num, mxstr3</p></td>
<td><p>Lookup table containing a description string for the unique observation variable names in obs_var.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ascii2nc-tool">
<h2><span class="section-number">4.2. </span>ASCII2NC tool<a class="headerlink" href="#ascii2nc-tool" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to run the ASCII2NC tool. The ASCII2NC tool is used to reformat ASCII point observations into the NetCDF format expected by the Point-Stat tool. For those users wishing to verify against point observations that are not available in PrepBUFR format, the ASCII2NC tool provides a way of incorporating those observations into MET. If the ASCII2NC tool is used to perform a reformatting step, no configuration file is needed. However, for more complex processing, such as summarizing time series observations, a configuration file may be specified. For details on the configuration file options, see the share/met/config/README file and example configuration files distributed with the MET code.</p>
<p>Initial versions of the ASCII2NC tool supported only a simple 11 column ASCII point observation format. It currently supports point observation data in the following formats: the default 11 column format, little_r format, SURFace RADiation (SURFRAD) and Integrated Surface Irradiance Study (ISIS) formats (found at <a class="reference external" href="http://www.esrl.noaa.gov/gmd/grad/surfrad/">http://www.esrl.noaa.gov/gmd/grad/surfrad/</a>), the Western Wind and Solar Integration Study (WWSIS) format, and the AErosol RObotic NEtwork (AERONET) versions 2 and 3 format (found at <a class="reference external" href="http://aeronet.gsfc.nasa.gov/">http://aeronet.gsfc.nasa.gov/</a>). WWSIS data are available by request from National Renewable Energy Laboratory (NREL) in Boulder, CO.</p>
<p>MET version 9.0 adds support for the passing observations to ascii2nc using a Python script with the “-format python” option. An example of running ASCII2NC with Python embedding is included below.</p>
<p>The default ASCII point observation format consists of one row of data per observation value. Each row of data consists of 11 columns as shown in <a class="reference internal" href="#table-reform-point-ascii2nc-format"><span class="std std-numref">Table 4.4</span></a>.</p>
<span id="table-reform-point-ascii2nc-format"></span><table class="colwidths-auto docutils align-default" id="id8">
<caption><span class="caption-number">Table 4.4 </span><span class="caption-text">Input MET ascii2nc point observation format</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"></th>
<th class="head"><p>ascii2nc ASCII Point Observation Format</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Column</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Message_Type</p></td>
<td><p>Text string containing the observation message type as described in the previous section on the PB2NC tool.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Station_ID</p></td>
<td><p>Text string containing the station id.</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Valid_Time</p></td>
<td><p>Text string containing the observation valid time in YYYYMMDD_HHMMSS format.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Lat</p></td>
<td><p>Latitude in degrees north of the observing location.</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Lon</p></td>
<td><p>Longitude in degrees east of the observation location.</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Elevation</p></td>
<td><p>Elevation in msl of the observing location.</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>GRIB_Code or Variable_Name</p></td>
<td><p>Integer GRIB code value or variable name corresponding to this observation type.</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>Level</p></td>
<td><p>Pressure level in hPa or accumulation interval in hours for the observation value.</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>Height</p></td>
<td><p>Height in msl or agl of the observation value.</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>QC_String</p></td>
<td><p>Quality control value.</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>Observation_Value</p></td>
<td><p>Observation value in units consistent with the GRIB code definition.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="ascii2nc-usage">
<h3><span class="section-number">4.2.1. </span>ascii2nc usage<a class="headerlink" href="#ascii2nc-usage" title="Permalink to this headline">¶</a></h3>
<p>Once the ASCII point observations have been formatted as expected, the ASCII file is ready to be processed by the ASCII2NC tool. The usage statement for ASCII2NC tool is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: ascii2nc
       ascii_file1 [ascii_file2 ... ascii_filen]
       netcdf_file
       [-format ASCII_format]
       [-config file]
       [-mask_grid string]
       [-mask_poly file]
       [-mask_sid file|list]
       [-log file]
       [-v level]
       [-compress level]
</pre></div>
</div>
<p>ascii2nc has two required arguments and can take several optional ones.</p>
<div class="section" id="required-arguments-for-ascii2nc">
<h4><span class="section-number">4.2.1.1. </span>Required arguments for ascii2nc<a class="headerlink" href="#required-arguments-for-ascii2nc" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>The <strong>ascii_file</strong> argument is the ASCII point observation file(s) to be processed. If using Python embedding with “-format python” provide a quoted string containing the Python script to be run followed by any command line arguments that script takes.</p></li>
<li><p>The <strong>netcdf_file</strong> argument is the NetCDF output file to be written.</p></li>
</ol>
</div>
<div class="section" id="optional-arguments-for-ascii2nc">
<h4><span class="section-number">4.2.1.2. </span>Optional arguments for ascii2nc<a class="headerlink" href="#optional-arguments-for-ascii2nc" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple" start="3">
<li><p>The <strong>-format ASCII_format</strong> option may be set to “met_point”, “little_r”, “surfrad”, “wwsis”, “aeronet”, “aeronetv2”, “aeronetv3”, or “python”. If passing in ISIS data, use the “surfrad” format flag.</p></li>
<li><p>The <strong>-config file</strong> option is the configuration file for generating time summaries.</p></li>
<li><p>The <strong>-mask_grid</strong> string option is a named grid or a gridded data file to filter the point observations spatially.</p></li>
<li><p>The <strong>-mask_poly</strong> file option is a polyline masking file to filter the point observations spatially.</p></li>
<li><p>The <strong>-mask_sid</strong> file|list option is a station ID masking file or a comma-separated list of station ID’s to filter the point observations spatially. See the description of the “sid” entry in <a class="reference internal" href="data_io.html#data-io-met-configuration-file-options"><span class="std std-numref">Section 3.5.1</span></a>.</p></li>
<li><p>The <strong>-log file</strong> option directs output and errors to the specified log file. All messages will be written to that file as well as standard out and error. Thus, users can save the messages without having to redirect the output on the command line. The default behavior is no log file.</p></li>
<li><p>The <strong>-v level</strong> option indicates the desired level of verbosity. The value of “level” will override the default setting of 2. Setting the verbosity to 0 will make the tool run with no log messages, while increasing the verbosity above 1 will increase the amount of logging.</p></li>
<li><p>The <strong>-compress level</strong> option indicates the desired level of compression (deflate level) for NetCDF variables. The valid level is between 0 and 9. The value of “level” will override the default setting of 0 from the configuration file or the environment variable MET_NC_COMPRESS. Setting the compression level to 0 will make no compression for the NetCDF output. Lower number is for fast compression and higher number is for better compression.</p></li>
</ol>
<p>An example of the <strong>ascii2nc</strong> calling sequence is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ascii2nc sample_ascii_obs.txt \
sample_ascii_obs.nc
</pre></div>
</div>
<p>In this example, the ASCII2NC tool will reformat the input <strong>sample_ascii_obs.txt file</strong> into NetCDF format and write the output to a file named <strong>sample_ascii_obs.nc</strong>.</p>
</div>
<div class="section" id="python-embedding-for-point-observations">
<span id="ascii2nc-pyembed"></span><h4><span class="section-number">4.2.1.3. </span>Python Embedding for Point Observations<a class="headerlink" href="#python-embedding-for-point-observations" title="Permalink to this headline">¶</a></h4>
<p>Here is an example of processing the same set of observations but using Python embedding instead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ascii2nc -format python \
“MET_BASE/python/read_ascii_point.py sample_ascii_obs.txt&quot; \
sample_ascii_obs_python.nc
</pre></div>
</div>
<p>Please refer to <a class="reference internal" href="appendixF.html#appendixf"><span class="std std-numref">Section 32</span></a> for more details about Python embedding in MET.</p>
</div>
</div>
<div class="section" id="ascii2nc-configuration-file">
<h3><span class="section-number">4.2.2. </span>ascii2nc configuration file<a class="headerlink" href="#ascii2nc-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>The default configuration file for the ASCII2NC tool named <strong>Ascii2NcConfig_default</strong> can be found in the installed share/met/config directory. It is recommended that users make a copy of this file prior to modifying its contents.</p>
<p>The ASCII2NC configuration file is optional and only necessary when defining time summaries or message type mapping for little_r data. The contents of the default ASCII2NC configuration file are described below.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>version = &quot;VN.N&quot;;
</pre></div>
</div>
<p>The configuration options listed above are common to many MET tools and are described in <a class="reference internal" href="data_io.html#data-io-met-configuration-file-options"><span class="std std-numref">Section 3.5.1</span></a>.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>time_summary = { ... }
</pre></div>
</div>
<p>The <strong>time_summary</strong> feature was implemented to allow additional processing of observations with high temporal resolution, such as SURFRAD data every 5 minutes. This option is described in <a class="reference internal" href="#pb2nc-configuration-file"><span class="std std-numref">Section 4.1.2</span></a>.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>        message_type_map = [
        { key = &quot;FM-12 SYNOP&quot;;  val = &quot;ADPSFC&quot;; },
        { key = &quot;FM-13 SHIP&quot;;   val = &quot;SFCSHP&quot;; },
        { key = &quot;FM-15 METAR&quot;;  val = &quot;ADPSFC&quot;; },
        { key = &quot;FM-18 BUOY&quot;;   val = &quot;SFCSHP&quot;; },
        { key = &quot;FM-281 QSCAT&quot;; val = &quot;ASCATW&quot;; },
        { key = &quot;FM-32 PILOT&quot;;  val = &quot;ADPUPA&quot;; },
        { key = &quot;FM-35 TEMP&quot;;   val = &quot;ADPUPA&quot;; },
        { key = &quot;FM-88 SATOB&quot;;  val = &quot;SATWND&quot;; },
        { key = &quot;FM-97 ACARS&quot;;  val = &quot;AIRCFT&quot;; }
];
</pre></div>
</div>
<p>This entry is an array of dictionaries, each containing a <strong>key</strong> string and <strong>val</strong> string which define a mapping of input strings to output message types. This mapping is currently only applied when converting input little_r report types to output message types.</p>
</div>
<div class="section" id="ascii2nc-output">
<h3><span class="section-number">4.2.3. </span>ascii2nc output<a class="headerlink" href="#ascii2nc-output" title="Permalink to this headline">¶</a></h3>
<p>The NetCDF output of the ASCII2NC tool is structured in the same way as the output of the PB2NC tool described in <a class="reference internal" href="#pb2nc-output"><span class="std std-numref">Section 4.1.3</span></a>.</p>
<p>“obs_vid” variable is replaced with “obs_gc” when the GRIB code is given instead of the variable names. In this case, the global variable “use_var_id” does not exist or set to false (use_var_id = “false” ;). Three variables (obs_var, obs_units, and obs_desc) related with variable names are not added.</p>
</div>
</div>
<div class="section" id="madis2nc-tool">
<h2><span class="section-number">4.3. </span>MADIS2NC tool<a class="headerlink" href="#madis2nc-tool" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to run the MADIS2NC tool. The MADIS2NC tool is used to reformat Meteorological Assimilation Data Ingest System (MADIS) point observations into the NetCDF format expected by the MET statistics tools. More information about MADIS data and formatting is available at <a class="reference external" href="http://madis.noaa.gov">http://madis.noaa.gov</a>. Since the MADIS2NC tool simply performs a reformatting step, no configuration file is needed. The MADIS2NC tool supports many of the MADIS data types, as listed in the usage statement below. Support for additional MADIS data types may be added in the future based on user feedback.</p>
<div class="section" id="madis2nc-usage">
<h3><span class="section-number">4.3.1. </span>madis2nc usage<a class="headerlink" href="#madis2nc-usage" title="Permalink to this headline">¶</a></h3>
<p>The usage statement for MADIS2NC tool is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: madis2nc
       madis_file [madis_file2 ... madis_filen]
       out_file
       -type str
       [-config file]
       [-qc_dd list]
       [-lvl_dim list]
       [-rec_beg n]
       [-rec_end n]
       [-mask_grid string]
       [-mask_poly file]
       [-mask_sid file|list]
       [-log file]
       [-v level]
       [-compress level]
</pre></div>
</div>
<p>madis2nc has required arguments and can also take optional ones.</p>
<div class="section" id="required-arguments-for-madis2nc">
<h4><span class="section-number">4.3.1.1. </span>Required arguments for madis2nc<a class="headerlink" href="#required-arguments-for-madis2nc" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>The <strong>madis_file</strong> argument is one or more input MADIS point observation files to be processed.</p></li>
<li><p>The <strong>netcdf_file</strong> argument is the NetCDF output file to be written.</p></li>
<li><p>The argument <strong>-type str</strong> is type of MADIS observations (metar, raob, profiler, maritime, mesonet or acarsProfiles).</p></li>
</ol>
</div>
<div class="section" id="optional-arguments-for-madis2nc">
<h4><span class="section-number">4.3.1.2. </span>Optional arguments for madis2nc<a class="headerlink" href="#optional-arguments-for-madis2nc" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple" start="4">
<li><p>The <strong>-config file</strong> option specifies the configuration file to generate summaries of the fields in the ASCII files.</p></li>
<li><p>The <strong>-qc_dd list</strong> option specifies a comma-separated list of QC flag values to be accepted(Z,C,S,V,X,Q,K,G,B).</p></li>
<li><p>The <strong>-lvl_dim list</strong> option specifies a comma-separated list of vertical level dimensions to be processed.</p></li>
<li><p>To specify the exact records to be processed, the <strong>-rec_beg n</strong> specifies the index of the first MADIS record to process and <strong>-rec_end n</strong> specifies the index of the last MADIS record to process. Both are zero-based.</p></li>
<li><p>The <strong>-mask_grid string</strong> option specifies a named grid or a gridded data file for filtering the point observations spatially.</p></li>
<li><p>The <strong>-mask_poly file</strong> option defines a polyline masking file for filtering the point observations spatially.</p></li>
<li><p>The <strong>-mask_sid file|list</strong> option is a station ID masking file or a comma-separated list of station ID’s for filtering the point observations spatially. See the description of the “sid” entry in  <a class="reference internal" href="data_io.html#data-io-met-configuration-file-options"><span class="std std-numref">Section 3.5.1</span></a>.</p></li>
<li><p>The <strong>-log file</strong> option directs output and errors to the specified log file. All messages will be written to that file as well as standard out and error. Thus, users can save the messages without having to redirect the output on the command line. The default behavior is no log file.</p></li>
<li><p>The <strong>-v level</strong> option indicates the desired level of verbosity. The value of “level” will override the default setting of 2. Setting the verbosity to 0 will make the tool run with no log messages, while increasing the verbosity will increase the amount of logging.</p></li>
<li><p>The <strong>-compress level</strong> option specifies the desired level of compression (deflate level) for NetCDF variables. The valid level is between 0 and 9. Setting the compression level to 0 will make no compression for the NetCDF output. Lower number is for fast compression and higher number is for better compression.</p></li>
</ol>
<p>An example of the madis2nc calling sequence is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>madis2nc sample_madis_obs.nc \
sample_madis_obs_met.nc -log madis.log -v 3
</pre></div>
</div>
<p>In this example, the MADIS2NC tool will reformat the input sample_madis_obs.nc file into NetCDF format and write the output to a file named sample_madis_obs_met.nc. Warnings and error messages will be written to the madis.log file, and the verbosity level of logging is three.</p>
</div>
</div>
<div class="section" id="madis2nc-configuration-file">
<h3><span class="section-number">4.3.2. </span>madis2nc configuration file<a class="headerlink" href="#madis2nc-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>The default configuration file for the MADIS2NC tool named <strong>Madis2NcConfig_default</strong> can be found in the installed share/met/config directory. It is recommended that users make a copy of this file prior to modifying its contents.</p>
<p>The MADIS2NC configuration file is optional and only necessary when defining time summaries. The contents of the default MADIS2NC configuration file are described below.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>version = &quot;VN.N&quot;;
</pre></div>
</div>
<p>The configuration options listed above are common to many MET tools and are described in <a class="reference internal" href="data_io.html#data-io-met-configuration-file-options"><span class="std std-numref">Section 3.5.1</span></a>.</p>
<hr class="docutils" />
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>time_summary = { ... }
</pre></div>
</div>
<p>The <strong>time_summary</strong> dictionary is described in <a class="reference internal" href="#pb2nc-configuration-file"><span class="std std-numref">Section 4.1.2</span></a>.</p>
</div>
<div class="section" id="madis2nc-output">
<h3><span class="section-number">4.3.3. </span>madis2nc output<a class="headerlink" href="#madis2nc-output" title="Permalink to this headline">¶</a></h3>
<p>The NetCDF output of the MADIS2NC tool is structured in the same way as the output of the PB2NC tool described in <a class="reference internal" href="#pb2nc-output"><span class="std std-numref">Section 4.1.3</span></a>.</p>
<p>“obs_vid” variable is replaced with “obs_gc” when the GRIB code is given instead of the variable names. In this case, the global variable “use_var_id” does not exist or set to false (use_var_id = “false” ;). Three variables (obs_var, obs_units, and obs_desc) related with variable names are not added.</p>
</div>
</div>
<div class="section" id="lidar2nc-tool">
<h2><span class="section-number">4.4. </span>LIDAR2NC tool<a class="headerlink" href="#lidar2nc-tool" title="Permalink to this headline">¶</a></h2>
<p>The LIDAR2NC tool creates a NetCDF point observation file from a CALIPSO HDF data file. Not all of the data present in the CALIPSO file is reproduced in the output, however. Instead, the output focuses mostly on information about clouds (as opposed to aerosols) as seen by the satellite along its ground track.</p>
<div class="section" id="lidar2nc-usage">
<h3><span class="section-number">4.4.1. </span>lidar2nc usage<a class="headerlink" href="#lidar2nc-usage" title="Permalink to this headline">¶</a></h3>
<p>The usage statement for LIDAR2NC tool is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: lidar2nc
       lidar_file
       -out out_file
       [-log file]
       [-v level]
       [-compress level]
</pre></div>
</div>
<p>Unlike most of the MET tools, lidar2nc does not use a config file. Currently, the options needed to run lidar2nc are not complex enough to require one.</p>
<div class="section" id="required-arguments-for-lidar2nc">
<h4><span class="section-number">4.4.1.1. </span>Required arguments for lidar2nc<a class="headerlink" href="#required-arguments-for-lidar2nc" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>The <strong>lidar_file</strong> argument is the input HDF lidar data file to be processed. Currently, CALIPSO files are supported but support for additional file types will be added in future releases.</p></li>
<li><p>The <strong>out_file</strong> argument is the NetCDF output file to be written.</p></li>
</ol>
</div>
<div class="section" id="optional-arguments-for-lidar2nc">
<h4><span class="section-number">4.4.1.2. </span>Optional arguments for lidar2nc<a class="headerlink" href="#optional-arguments-for-lidar2nc" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple" start="3">
<li><p>The <strong>-log file</strong> option directs output and errors to the specified log file. All messages will be written to that file as well as standard out and error. Thus, users can save the messages without having to redirect the output on the command line. The default behavior is no log file.</p></li>
<li><p>The <strong>-v level</strong> option indicates the desired level of verbosity. The value of “level” will override the default setting of 2. Setting the verbosity to 0 will make the tool run with no log messages, while increasing the verbosity above 1 will increase the amount of logging.</p></li>
<li><p>The <strong>-compress level</strong> option indicates the desired level of compression (deflate level) for NetCDF variables. The valid level is between 0 and 9. The value of “level” will override the default setting of 0 from the configuration file or the environment variable MET_NC_COMPRESS. Setting the compression level to 0 will make no compression for the NetCDF output. Lower number is for fast compression and higher number is for better compression.</p></li>
</ol>
</div>
</div>
<div class="section" id="lidar2nc-output">
<h3><span class="section-number">4.4.2. </span>lidar2nc output<a class="headerlink" href="#lidar2nc-output" title="Permalink to this headline">¶</a></h3>
<p>Each observation type in the lidar2nc output is assigned a GRIB code. These are outlined in <a class="reference internal" href="#lidar2nc-grib-code-table"><span class="std std-numref">Table 4.5</span></a>. GRIB codes were assigned to these fields arbitrarily, with GRIB codes in the 600s denoting individual bit fields taken from the feature classification flag field in the CALIPSO file.</p>
<p>We will not give a detailed description of each CALIPSO data product that lidar2nc reads. Users should refer to existing CALIPSO documentation for this information. We will, however, give some explanation of how the cloud layer base and top information is encoded in the lidar2nc NetCDF output file.</p>
<p><strong>Layer_Base</strong> gives the elevation in meters above ground level of the cloud base for each cloud level at each observation location. Similarly, <strong>Layer_Top</strong> gives the elevation of the top of each cloud layer. Note that if there are multiple cloud layers at a particular location, then there will be more than one base (or top) given for that location. For convenience, <strong>Min_Base</strong> and <strong>Max_Top</strong> give, respectively, the base elevation for the bottom cloud layer, and the top elevation for the top cloud layer. For these data types, there will be only one value per observation location regardless of how many cloud layers there are at that location.</p>
<span id="lidar2nc-grib-code-table"></span><table class="colwidths-auto docutils align-default" id="id9">
<caption><span class="caption-number">Table 4.5 </span><span class="caption-text">lidar2nc GRIB codes and their meaning, units, and abbreviations</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>GRIB Code</p></th>
<th class="head"><p>Meaning</p></th>
<th class="head"><p>Units</p></th>
<th class="head"><p>Abbreviation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>500</p></td>
<td><p>Number of Cloud Layers</p></td>
<td><p>NA</p></td>
<td><p>NLayers</p></td>
</tr>
<tr class="row-odd"><td><p>501</p></td>
<td><p>Cloud Layer Base AGL</p></td>
<td><p>m</p></td>
<td><p>Layer_Base</p></td>
</tr>
<tr class="row-even"><td><p>502</p></td>
<td><p>Cloud Layer Top AGL</p></td>
<td><p>m</p></td>
<td><p>Layer_Top</p></td>
</tr>
<tr class="row-odd"><td><p>503</p></td>
<td><p>Cloud Opacity</p></td>
<td><p>%</p></td>
<td><p>Opacity</p></td>
</tr>
<tr class="row-even"><td><p>504</p></td>
<td><p>CAD Score</p></td>
<td><p>NA</p></td>
<td><p>CAD_Score</p></td>
</tr>
<tr class="row-odd"><td><p>505</p></td>
<td><p>Minimum Cloud Base AGL</p></td>
<td><p>m</p></td>
<td><p>Min_Base</p></td>
</tr>
<tr class="row-even"><td><p>506</p></td>
<td><p>Maximum Cloud Top AGL</p></td>
<td><p>m</p></td>
<td><p>Max_Top</p></td>
</tr>
<tr class="row-odd"><td><p>600</p></td>
<td><p>Feature Type</p></td>
<td><p>NA</p></td>
<td><p>Feature_Type</p></td>
</tr>
<tr class="row-even"><td><p>601</p></td>
<td><p>Ice/Water Phase</p></td>
<td><p>NA</p></td>
<td><p>Ice_Water_Phase</p></td>
</tr>
<tr class="row-odd"><td><p>602</p></td>
<td><p>Feature Sub-Type</p></td>
<td><p>NA</p></td>
<td><p>Feature_Sub_Type</p></td>
</tr>
<tr class="row-even"><td><p>603</p></td>
<td><p>Cloud/Aerosol/PSC Type QA</p></td>
<td><p>NA</p></td>
<td><p>Cloud_Aerosol_PSC_Type_QA</p></td>
</tr>
<tr class="row-odd"><td><p>604</p></td>
<td><p>Horizontal Averaging</p></td>
<td><p>NA</p></td>
<td><p>Horizontal_Averaging</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="point2grid-tool">
<h2><span class="section-number">4.5. </span>Point2Grid tool<a class="headerlink" href="#point2grid-tool" title="Permalink to this headline">¶</a></h2>
<p>The Point2Grid tool takes point observations from a NetCDF output file from one of the four previously mentioned MET tools (ascii2nc, madis2nc, pb2nc, lidar2nc) and creates a gridded NetCDF file. The other point observations are GOES-16/17 input files in NetCDF format (especially, Aerosol Optical Depth. Future development will include support for reading input files not produced from MET tools.</p>
<div class="section" id="point2grid-usage">
<h3><span class="section-number">4.5.1. </span>point2grid usage<a class="headerlink" href="#point2grid-usage" title="Permalink to this headline">¶</a></h3>
<p>The usage statement for the Point2Grid tool is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: point2grid
       input_filename
       to_grid
       output_filename
       -field string
       [-config file]
       [-qc flags]
       [-adp adp_file_name]
       [-method type]
       [-gaussian_dx n]
       [-gaussian_radius n]
       [-prob_cat_thresh string]
       [-vld_thresh n]
       [-name list]
       [-log file]
       [-v level]
       [-compress level]
</pre></div>
</div>
<div class="section" id="required-arguments-for-point2grid">
<h4><span class="section-number">4.5.1.1. </span>Required arguments for point2grid<a class="headerlink" href="#required-arguments-for-point2grid" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>The <strong>input_filename</strong> argument indicates the name of the input NetCDF file to be processed. Currently, only NetCDF files produced from the ascii2nc, madis2nc, pb2nc, and lidar2nc are supported. And AOD dataset from GOES16/17 are supported, too. Support for additional file types will be added in future releases.</p></li>
<li><p>The to_grid argument defines the output grid as: (1) a named grid, (2) the path to a gridded data file, or (3) an explicit grid specification string.</p></li>
<li><p>The output_filename argument is the name of the output NetCDF file to be written.</p></li>
<li><p>The -field string argument is a string that defines the data to be regridded. It may be used multiple times. If -adp option is given (for AOD data from GOES16/17), the name consists with the variable name from the input data file and the variable name from ADP data file (for example, “AOD_Smoke” or “AOD_Dust”: getting AOD variable from the input data and applying smoke or dust variable from ADP data file).</p></li>
</ol>
</div>
<div class="section" id="optional-arguments-for-point2grid">
<h4><span class="section-number">4.5.1.2. </span>Optional arguments for point2grid<a class="headerlink" href="#optional-arguments-for-point2grid" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple" start="5">
<li><p>The <strong>-config</strong> file option is the configuration file to be used.</p></li>
<li><p>The <strong>-qc</strong> flags option specifies a comma-separated list of quality control (QC) flags, for example “0,1”. This should only be applied if grid_mapping is set to “goes_imager_projection” and the QC variable exists.</p></li>
<li><p>The <strong>-adp adp_file_name</strong> option provides an additional Aerosol Detection Product (ADP) information on aerosols, dust, and smoke. This option is ignored if the requested variable is not AOD (“AOD_Dust” or “AOD_Smoke”) from GOES16/17. The gridded data is filtered by the presence of dust/smoke. If -qc options is given, it’s applied to QC of dust/smoke, too (First filtering with AOD QC values and the second filtering with dust/smoke QC values).</p></li>
<li><p>The <strong>-method type</strong> option specifies the regridding method. The default method is UW_MEAN.</p></li>
<li><p>The <strong>-gaussian_dx n</strong> option defines the distance interval for Gaussian smoothing. The default is 81.271 km. Ignored if the method is not GAUSSIAN or MAXGAUSS.</p></li>
<li><p>The <strong>-gaussian_radius</strong> n option defines the radius of influence for Gaussian interpolation. The default is 120. Ignored if the method is not GAUSSIAN or MAXGAUSS.</p></li>
</ol>
<p>11.The <strong>-prob_cat_thresh string</strong> option sets the threshold to compute the probability of occurrence. The default is set to disabled. This option is relevant when calculating practically perfect forecasts.</p>
<ol class="arabic simple" start="12">
<li><p>The <strong>-vld_thresh n</strong> option sets the required ratio of valid data for regridding. The default is 0.5.</p></li>
<li><p>The <strong>-name list</strong> option specifies a comma-separated list of output variable names for each field specified.</p></li>
<li><p>The <strong>-log file</strong> option directs output and errors to the specified log file. All messages will be written to that file as well as standard out and error. Thus, users can save the messages without having to redirect the output on the command line. The default behavior is no log file.</p></li>
<li><p>The <strong>-v level</strong> option indicates the desired level of verbosity. The value of “level” will override the default setting of 2. Setting the verbosity to 0 will make the tool run with no log messages, while increasing the verbosity above 1 will increase the amount of logging.</p></li>
<li><p>The <strong>-compress level</strong> option indicates the desired level of compression (deflate level) for NetCDF variables. The valid level is between 0 and 9. The value of “level” will override the default setting of 0 from the configuration file or the environment variable MET_NC_COMPRESS. Setting the compression level to 0 will make no compression for the NetCDF output. Lower number is for fast compression and higher number is for better compression.</p></li>
</ol>
<p>Only 4 interpolation methods are applied to the field variables; MIN/MAX/MEDIAN/UW_MEAN. The GAUSSIAN method is applied to the probability variable only. Unlike regrad_data_plane, MAX method is applied to the file variable and Gaussian method to the probability variable with the MAXGAUSS method. If the probability variable is not requested, MAXGAUSS method is the same as MAX method.</p>
<p>For the GOES-16 and GOES-17 data, the computing lat/long is time consuming. So the computed coordinate (lat/long) is saved into the NetCDF file to the environment variable MET_TMP_DIR or /tmp if MET_TMP_DIR is not defined. The computing lat/long step can be skipped if the coordinate file is given through the environment variable MET_GEOSTATIONARY_DATA. The grid mapping to the target grid is saved to MET_TMP_DIR to save the execution time. Once this file is created, the MET_GEOSTATIONARY_DATA is ignored. The grid mapping file should be deleted manually in order to apply a new MET_GEOSTATIONARY_DATA environment variable or to re-generate the grid mapping file. An example of call point2grid to process GOES-16 AOD data is shown below:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>point2grid \
OR_ABI-L2-AODC-M3_G16_s20181341702215_e20181341704588_c20181341711418.nc \
G212 \
regrid_data_plane_GOES-16_AOD_TO_G212.nc \
-field &#39;name=&quot;AOD&quot;; level=&quot;(*,*)&quot;;&#39; \
-qc 0,1,2
-method MAX -v 1
</pre></div>
</div>
<p>When processing GOES-16 data, the <strong>-qc</strong> option may also be used to specify the acceptable quality control flag values. The example above regrids the GOES-16 AOD values to NCEP Grid number 212 (which QC flags are high, medium, and low), writing to the output the maximum AOD value falling inside each grid box.</p>
</div>
</div>
<div class="section" id="point2grid-output">
<h3><span class="section-number">4.5.2. </span>point2grid output<a class="headerlink" href="#point2grid-output" title="Permalink to this headline">¶</a></h3>
<p>The point2grid tool will output a gridded NetCDF file containing the following:</p>
<ol class="arabic simple">
<li><p>Latitude</p></li>
<li><p>Longitude</p></li>
<li><p>The variable specified in the -field string regridded to the grid defined in the to_grid argument.</p></li>
<li><p>The count field which represents the number of point observations that were included calculating the value of the variable at that grid cell.</p></li>
<li><p>The mask field which is a binary field representing the presence or lack thereof of point observations at that grid cell. A value of “1” indicates that there was at least one point observation within the bounds of that grid cell and a value of “0” indicates the lack of point observations at that grid cell.</p></li>
<li><p>The probability field which is the probability of the event defined by the -prob_cat_thresh command line option. The output variable name includes the threshold used to define the probability. Ranges from 0 to 1.</p></li>
<li><p>The probability mask field which is a binary field that represents whether or not there is probability data at that grid point. Can be either “0” or “1” with “0” meaning the probability value does not exist and a value of “1” meaning that the probability value does exist.</p></li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reformat_grid.html" class="btn btn-neutral float-right" title="5. Re-Formatting of Gridded Fields" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data_io.html" class="btn btn-neutral float-left" title="3. MET Data I/O" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, UCAR/NCAR, NOAA, and CSU/CIRA

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>